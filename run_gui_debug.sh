#!/bin/bash

# Скрипт для запуска GUI Infra с подробным логированием

echo "Запуск Infra GUI в режиме отладки"

# Активируем виртуальное окружение, если оно существует
if [ -d ".venv" ]; then
    echo "Активация виртуального окружения..."
    source .venv/bin/activate
fi

# Установка переменных окружения для отладки
export PYTHONPATH=$(pwd)
export INFRA_DEBUG=1

# Проверяем наличие доступных логов и создаем директорию, если нужно
LOG_DIR="logs"
if [ ! -d "$LOG_DIR" ]; then
    mkdir -p $LOG_DIR
    echo "Создана директория логов: $LOG_DIR"
fi

# Запускаем приложение с перенаправлением вывода в файл лога
LOG_FILE="$LOG_DIR/infra_gui_$(date +%Y%m%d_%H%M%S).log"
echo "Логи будут сохранены в файл: $LOG_FILE"

# Запуск приложения напрямую через Python для лучшей диагностики
python -m infra.gui.app 2>&1 | tee "$LOG_FILE"

# Если есть ошибки запуска, они будут отображены в файле логов
echo "Завершено. Проверьте логи в файле: $LOG_FILE" 